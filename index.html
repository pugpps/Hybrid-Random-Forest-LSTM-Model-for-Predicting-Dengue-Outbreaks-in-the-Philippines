<script>
// ðŸ”— Replace this URL with your GitHub RAW CSV link
const csvUrl = "https://raw.githubusercontent.com/<username>/<repo>/main/dengue_output.csv";

// Auto-load CSV from GitHub
fetch(csvUrl)
    .then(response => response.text())
    .then(text => {
        const lines = text.split("\n").slice(1);
        let dates = [], actual = [], predicted = [];

        lines.forEach(row => {
            const cols = row.split(",");
            if(cols.length >= 3){
                dates.push(cols[0]);
                actual.push(parseFloat(cols[1]));
                predicted.push(parseFloat(cols[2]));
            }
        });

        // --- Chart 1: Actual vs Predicted ---
        new Chart(document.getElementById('chart1'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    { label: 'Actual', data: actual, borderColor: '#1c3d70', borderWidth: 2, tension: 0.3 },
                    { label: 'Predicted', data: predicted, borderColor: '#e67e22', borderWidth: 2, tension: 0.3 }
                ]
            }
        });

        // --- Metrics ---
        function avg(arr){ return arr.reduce((a,b)=>a+b,0) / arr.length; }
        function RMSE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=(a[i]-p[i])**2; return Math.sqrt(s/a.length); }
        function MAE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=Math.abs(a[i]-p[i]); return s/a.length; }
        function MAPE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=Math.abs((a[i]-p[i])/a[i]); return (s/a.length)*100; }

        let rmse = RMSE(actual, predicted);
        let mae = MAE(actual, predicted);
        let mape = MAPE(actual, predicted);
        let accuracy = (100 - mape).toFixed(2);

        document.getElementById("metrics").innerHTML = `
            RMSE: <b>${rmse.toFixed(2)}</b><br>
            MAE: <b>${mae.toFixed(2)}</b><br>
            MAPE: <b>${mape.toFixed(2)}%</b><br><br>
            <span class="highlight">Accuracy: ${accuracy}%</span>
        `;

        // --- Summary Stats ---
        document.getElementById("summary").innerHTML = `
            <b>Date Range:</b> ${dates[0]} â†’ ${dates[dates.length-1]}<br>
            <b>Highest Actual Case:</b> ${Math.max(...actual)}<br>
            <b>Lowest Actual Case:</b> ${Math.min(...actual)}<br>
            <b>Highest Predicted Case:</b> ${Math.max(...predicted)}<br>
            <b>Lowest Predicted Case:</b> ${Math.min(...predicted)}<br>
        `;

        // --- Trend Forecast ---
        let growthRates = [];
        for (let i = 1; i < predicted.length; i++) {
            if (predicted[i-1] > 0) {
                growthRates.push(predicted[i] / predicted[i-1]);
            }
        }

        let avgTrend = avg(growthRates);
        let lastPred = predicted[predicted.length - 1];
        let nextForecast = (lastPred * avgTrend).toFixed(2);

        document.getElementById("forecast").innerHTML =
            `<b>Projected Dengue Cases Next Month:</b> <span class="highlight">${nextForecast}</span>`;

        // --- Forecast Chart ---
        let futureDate = getNextMonth(dates[dates.length - 1]);
        const extendedDates = [...dates, futureDate];
        const extendedPreds = [...predicted, nextForecast];

        new Chart(document.getElementById('chart5'), {
            type: 'line',
            data: {
                labels: extendedDates,
                datasets: [
                    { label: 'Predicted', data: predicted, borderColor: '#e67e22', borderWidth: 2 },
                    { label: 'Forecast Next Month', data: extendedPreds, borderColor: '#0a7c25', borderDash:[6,6], borderWidth: 2 }
                ]
            }
        });

        function getNextMonth(dateString){
            let d = new Date(dateString);
            d.setMonth(d.getMonth() + 1);
            return d.toISOString().split("T")[0].slice(0,7) + "-01";
        }
    });
</script>
