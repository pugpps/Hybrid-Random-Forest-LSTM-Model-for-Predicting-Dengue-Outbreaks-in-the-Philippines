<script>
// ðŸ”¥ Auto-load dashboard_output.json (must be in the same folder)
fetch("dashboard_output.json")
    .then(response => response.json())
    .then(data => {

        const dates = data.dates;
        const actual = data.actual;
        const predicted = data.predicted;

        // --- Chart 1: Actual vs Predicted ---
        new Chart(document.getElementById('chart1'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    { label: 'Actual', data: actual, borderColor: '#1c3d70', borderWidth: 2, tension: 0.3 },
                    { label: 'Predicted', data: predicted, borderColor: '#e67e22', borderWidth: 2, tension: 0.3 }
                ]
            }
        });

        // --- Metrics ---
        function RMSE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=(a[i]-p[i])**2; return Math.sqrt(s/a.length); }
        function MAE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=Math.abs(a[i]-p[i]); return s/a.length; }
        function MAPE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=Math.abs((a[i]-p[i])/a[i]); return (s/a.length)*100; }

        let rmse = RMSE(actual, predicted);
        let mae = MAE(actual, predicted);
        let mape = MAPE(actual, predicted);

        document.getElementById("metrics").innerHTML = `
            RMSE: <b>${rmse.toFixed(2)}</b><br>
            MAE: <b>${mae.toFixed(2)}</b><br>
            MAPE: <b>${mape.toFixed(2)}%</b><br><br>
            <span class="highlight">Accuracy: ${(100 - mape).toFixed(2)}%</span>
        `;

        // --- Summary Stats ---
        document.getElementById("summary").innerHTML = `
            <b>Date Range:</b> ${dates[0]} â†’ ${dates[dates.length-1]}<br>
            <b>Highest Actual:</b> ${Math.max(...actual)}<br>
            <b>Lowest Actual:</b> ${Math.min(...actual)}<br>
            <b>Highest Predicted:</b> ${Math.max(...predicted)}<br>
            <b>Lowest Predicted:</b> ${Math.min(...predicted)}<br>
        `;

        // --- Forecast from JSON ---
        const f_dates = data.forecast_dates;
        const f_values = data.forecast_values;

        document.getElementById("forecast").innerHTML =
            `<b>Next 4 Months Forecast:</b><br><br>` +
            f_dates.map((d,i) => `${d}: <span class='highlight'>${Math.round(f_values[i])}</span>`).join("<br>");

        // --- Forecast Chart ---
        new Chart(document.getElementById('chart5'), {
            type: 'line',
            data: {
                labels: f_dates,
                datasets: [
                    { label: 'Forecast Next 4 Months', data: f_values, borderColor: '#0a7c25', borderWidth: 2 }
                ]
            }
        });
    });
</script>
