<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dengue Forecasting Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #eef2f7;
    }

    .container {
        background: white;
        max-width: 950px;
        margin: 40px auto;
        padding: 35px;
        border-radius: 14px;
        box-shadow: 0 6px 25px rgba(0,0,0,0.1);
    }

    h2 {
        margin-top: 0;
        color: #1c3d70;
    }

    input[type="file"] {
        padding: 12px;
        background: #f8f9fc;
        border: 1px solid #d6d9e0;
        border-radius: 8px;
        width: 100%;
        cursor: pointer;
    }

    canvas {
        margin-top: 20px;
        background: #ffffff;
        border-radius: 8px;
        padding: 10px;
    }

    .metric-box {
        background: #f4f7fb;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 5px solid #1c3d70;
    }

    .highlight {
        font-weight: bold;
        color: #0a7c25;
    }

    .section-title {
        margin-top: 35px;
        color: #1c3d70;
        font-weight: bold;
        border-left: 4px solid #1c3d70;
        padding-left: 10px;
    }
</style>
</head>
<body>

<div class="container">
    <h2>ðŸ¦Ÿ Dengue Forecasting Dashboard</h2>
    <p>Upload your dengue prediction CSV file below:</p>

    <input type="file" id="csvFile" accept=".csv">

    <h3 class="section-title">ðŸ“Š Actual vs Predicted</h3>
    <canvas id="chart1"></canvas>

    <h3 class="section-title">ðŸ“Œ Model Accuracy</h3>
    <div id="metrics" class="metric-box"></div>

    <h3 class="section-title">ðŸ“‹ Summary Statistics</h3>
    <div id="summary" class="metric-box"></div>

    <h3 class="section-title">ðŸ”® Forecast Next Month</h3>
    <div id="forecast" class="metric-box"></div>

    <h3 class="section-title">ðŸ“ˆ Forecast Visualization</h3>
    <canvas id="chart5"></canvas>
</div>

<script>
document.getElementById("csvFile").addEventListener("change", function (event) {

    const file = event.target.files[0];
    const reader = new FileReader();
    
    reader.onload = function (e) {
        const lines = e.target.result.split("\n").slice(1);
        let dates = [], actual = [], predicted = [];

        lines.forEach(row => {
            const cols = row.split(",");
            if(cols.length >= 3){
                dates.push(cols[0]);
                actual.push(parseFloat(cols[1]));
                predicted.push(parseFloat(cols[2]));
            }
        });

        // --- Chart 1: Actual vs Predicted ---
        new Chart(document.getElementById('chart1'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    { label: 'Actual', data: actual, borderColor: '#1c3d70', borderWidth: 2, tension: 0.3 },
                    { label: 'Predicted', data: predicted, borderColor: '#e67e22', borderWidth: 2, tension: 0.3 }
                ]
            }
        });

        // --- Metrics ---
        function avg(arr){ return arr.reduce((a,b)=>a+b,0) / arr.length; }
        function RMSE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=(a[i]-p[i])**2; return Math.sqrt(s/a.length); }
        function MAE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=Math.abs(a[i]-p[i]); return s/a.length; }
        function MAPE(a,p){ let s=0; for(let i=0;i<a.length;i++) s+=Math.abs((a[i]-p[i])/a[i]); return (s/a.length)*100; }

        let rmse = RMSE(actual, predicted);
        let mae = MAE(actual, predicted);
        let mape = MAPE(actual, predicted);
        let accuracy = (100 - mape).toFixed(2);

        document.getElementById("metrics").innerHTML = `
            RMSE: <b>${rmse.toFixed(2)}</b><br>
            MAE: <b>${mae.toFixed(2)}</b><br>
            MAPE: <b>${mape.toFixed(2)}%</b><br><br>
            <span class="highlight">Accuracy: ${accuracy}%</span>
        `;

        // --- Summary Stats ---
        document.getElementById("summary").innerHTML = `
            <b>Date Range:</b> ${dates[0]} â†’ ${dates[dates.length-1]}<br>
            <b>Highest Actual Case:</b> ${Math.max(...actual)}<br>
            <b>Lowest Actual Case:</b> ${Math.min(...actual)}<br>
            <b>Highest Predicted Case:</b> ${Math.max(...predicted)}<br>
            <b>Lowest Predicted Case:</b> ${Math.min(...predicted)}<br>
        `;

        // --- Trend Forecast ---
        let growthRates = [];
        for (let i = 1; i < predicted.length; i++) {
            if (predicted[i-1] > 0) {
                growthRates.push(predicted[i] / predicted[i-1]);
            }
        }

        let avgTrend = avg(growthRates);
        let lastPred = predicted[predicted.length - 1];
        let nextForecast = (lastPred * avgTrend).toFixed(2);

        document.getElementById("forecast").innerHTML =
            `<b>Projected Dengue Cases Next Month:</b> <span class="highlight">${nextForecast}</span>`;

        // --- Forecast Chart ---
        let futureDate = getNextMonth(dates[dates.length - 1]);
        const extendedDates = [...dates, futureDate];
        const extendedPreds = [...predicted, nextForecast];

        new Chart(document.getElementById('chart5'), {
            type: 'line',
            data: {
                labels: extendedDates,
                datasets: [
                    { label: 'Predicted', data: predicted, borderColor: '#e67e22', borderWidth: 2 },
                    { label: 'Forecast Next Month', data: extendedPreds, borderColor: '#0a7c25', borderDash:[6,6], borderWidth: 2 }
                ]
            }
        });

        function getNextMonth(dateString){
            let d = new Date(dateString);
            d.setMonth(d.getMonth() + 1);
            return d.toISOString().split("T")[0].slice(0,7) + "-01";
        }
    };

    reader.readAsText(file);
});
</script>

</body>
</html>